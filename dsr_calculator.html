                        <div class="detail-row">
                            <span>ìë™ì°¨ëŒ€ì¶œ ì›”ìƒí™˜ì•¡</span>
                            <span id="detail-auto-payment">0ë§Œì›</span>
                        </div><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤íŠ¸ë ˆìŠ¤ DSR 3ë‹¨ê³„ ëŒ€ì¶œê³„ì‚°ê¸° (ìë™ì°¨ í¬í•¨)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }

        .input-section {
            padding: 40px;
            background: #f8f9fa;
            max-height: 90vh;
            overflow-y: auto;
        }

        .result-section {
            padding: 40px;
            background: white;
            max-height: 90vh;
            overflow-y: auto;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .subsection {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .subsection h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.2rem;
            border-bottom: 2px solid #e1e5e9;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 0.95rem;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .toggle-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .income-toggle {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .income-toggle label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 20px;
            background: white;
            border-radius: 25px;
            border: 2px solid #e1e5e9;
            transition: all 0.3s ease;
        }

        .income-toggle input[type="radio"]:checked + span {
            background: #667eea;
            color: white;
        }

        .income-toggle input[type="radio"] {
            display: none;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .result-card .amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .detail-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .detail-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e1e5e9;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-row span:first-child {
            color: #666;
        }

        .detail-row span:last-child {
            font-weight: 600;
            color: #333;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
        }

        .info-box {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #17a2b8;
        }

        .success-box {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }

        .auto-section {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .input-section, .result-section {
                padding: 20px;
                max-height: none;
            }

            .income-toggle {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ ğŸš— ìŠ¤íŠ¸ë ˆìŠ¤ DSR 3ë‹¨ê³„ ëŒ€ì¶œê³„ì‚°ê¸°</h1>
            <p>2025ë…„ 7ì›” 1ì¼ ì‹œí–‰ | ìë™ì°¨ ëŒ€ì¶œÂ·ë ŒíƒˆÂ·ë¦¬ìŠ¤ í¬í•¨</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">ğŸ“Š ì†Œë“ ì •ë³´</h2>
                
                <div class="subsection">
                    <div class="income-toggle">
                        <label>
                            <input type="radio" name="income-type" value="gross" checked>
                            <span>ì„¸ì „ ì†Œë“</span>
                        </label>
                        <label>
                            <input type="radio" name="income-type" value="net">
                            <span>ì‹¤ìˆ˜ë ¹ì•¡</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label for="income" id="income-label">ì—°ì†Œë“ (ì„¸ì „, ë§Œì›)</label>
                        <input type="number" id="income" placeholder="ì˜ˆ: 5000" min="0">
                    </div>

                    <div class="form-group">
                        <label for="region">ì£¼íƒ ì†Œì¬ì§€</label>
                        <select id="region">
                            <option value="metropolitan">ìˆ˜ë„ê¶Œ (ì„œìš¸/ì¸ì²œ/ê²½ê¸°)</option>
                            <option value="non-metropolitan">ë¹„ìˆ˜ë„ê¶Œ (ì§€ë°©)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="financial-sector">ì£¼ ê±°ë˜ ê¸ˆìœµê¸°ê´€</label>
                        <select id="financial-sector">
                            <option value="1st">1ê¸ˆìœµê¶Œ (ì€í–‰)</option>
                            <option value="2nd">2ê¸ˆìœµê¶Œ (ì €ì¶•ì€í–‰/ìƒí˜¸ê¸ˆìœµ ë“±)</option>
                        </select>
                    </div>
                </div>

                <h2 class="section-title">ğŸ  ì£¼íƒê´€ë ¨ ëŒ€ì¶œ</h2>
                
                <div class="subsection">
                    <div class="form-group">
                        <label for="existing-mortgage">ê¸°ì¡´ ì£¼íƒë‹´ë³´ëŒ€ì¶œ (ë§Œì›)</label>
                        <input type="number" id="existing-mortgage" placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="existing-credit">ê¸°ì¡´ ì‹ ìš©ëŒ€ì¶œ (ë§Œì›)</label>
                        <input type="number" id="existing-credit" placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="existing-card">ê¸°ì¡´ ì¹´ë“œë¡ /í˜„ê¸ˆì„œë¹„ìŠ¤ (ë§Œì›)</label>
                        <input type="number" id="existing-card" placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="existing-other">ê¸°ì¡´ ê¸°íƒ€ëŒ€ì¶œ (ë§Œì›)</label>
                        <input type="number" id="existing-other" placeholder="0" min="0">
                    </div>
                </div>

                <h2 class="section-title">ğŸš— ìë™ì°¨ ê´€ë ¨</h2>
                
                <div class="subsection auto-section">
                    <h3>ìë™ì°¨ ëŒ€ì¶œ</h3>
                    <div class="form-group">
                        <label for="auto-loan">ê¸°ì¡´ ìë™ì°¨ ëŒ€ì¶œ (ë§Œì›)</label>
                        <input type="number" id="auto-loan" placeholder="0" min="0">
                    </div>
                </div>

                <div class="subsection auto-section">
                    <h3>ì¥ê¸°ë Œíƒˆ / ë¦¬ìŠ¤ (DSR í¬í•¨)</h3>
                    <div class="form-group">
                        <label for="rental-monthly">ì›” ë Œíƒˆ/ë¦¬ìŠ¤ë£Œ (ë§Œì›)</label>
                        <input type="number" id="rental-monthly" placeholder="0" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="rental-term">ì”ì—¬ ê³„ì•½ê¸°ê°„ (ê°œì›”)</label>
                        <input type="number" id="rental-term" placeholder="0" min="0">
                    </div>
                    <small style="color: #666;">â€» DSR 3ë‹¨ê³„ë¶€í„° ì¥ê¸°ë Œíƒˆë„ DSR ê³„ì‚°ì— í¬í•¨ë©ë‹ˆë‹¤</small>
                </div>

                <h2 class="section-title">ğŸ’° ëŒ€ì¶œ ì¡°ê±´</h2>
                
                <div class="subsection">
                    <div class="form-group">
                        <label for="interest-rate">ê¸°ì¤€ ê¸ˆë¦¬ (%)</label>
                        <input type="number" id="interest-rate" placeholder="4.5" step="0.1" min="0" value="4.5">
                    </div>

                    <div class="form-group">
                        <label for="loan-term">ëŒ€ì¶œ ê¸°ê°„ (ë…„)</label>
                        <input type="number" id="loan-term" placeholder="30" min="1" max="50" value="30">
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="policy-loan">
                        <label for="policy-loan">ì •ì±…ëª¨ê¸°ì§€ ì´ìš© (ë³´ê¸ˆìë¦¬ë¡ /ë””ë”¤ëŒ ë“±)</label>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateLoan()">ğŸ’° ì¢…í•© ëŒ€ì¶œí•œë„ ê³„ì‚°í•˜ê¸°</button>
            </div>

            <div class="result-section">
                <h2 class="section-title">ğŸ“ˆ ê³„ì‚° ê²°ê³¼</h2>

                <div class="info-box">
                    <strong>ğŸš— DSR 3ë‹¨ê³„ ì¥ê¸°ë Œíƒˆ í¬í•¨:</strong><br>
                    â€¢ ìë™ì°¨ ëŒ€ì¶œ: DSR ê³„ì‚° í¬í•¨<br>
                    â€¢ ì¥ê¸°ë Œíƒˆ/ë¦¬ìŠ¤: DSR ê³„ì‚° í¬í•¨ (3ë‹¨ê³„ë¶€í„°)<br>
                    â€¢ ëª¨ë“  ê¸ˆìœµë¶€ì±„ê°€ DSRì— ë°˜ì˜ë¨
                </div>

                <div id="results" style="display: none;">
                    <div class="result-card">
                        <h3>ìµœëŒ€ ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡</h3>
                        <div class="amount" id="max-loan">0ì›</div>
                        <small>ìŠ¤íŠ¸ë ˆìŠ¤ DSR ì ìš© ê¸°ì¤€</small>
                    </div>

                    <div class="detail-card">
                        <h4>ğŸ“Š ì†Œë“ ì •ë³´</h4>
                        <div class="detail-row">
                            <span>ì…ë ¥ ì†Œë“</span>
                            <span id="input-income">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì—°ì†Œë“ (ì„¸ì „)</span>
                            <span id="gross-income">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì—°ì†Œë“ (ì„¸í›„)</span>
                            <span id="net-income">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì›”ì†Œë“ (ì„¸ì „)</span>
                            <span id="monthly-gross">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì›”ì†Œë“ (ì„¸í›„)</span>
                            <span id="monthly-net">0ë§Œì›</span>
                        </div>
                    </div>

                    <div class="detail-card">
                        <h4>ğŸ“Š DSR ìƒì„¸ ë‚´ì—­</h4>
                        <div class="detail-row">
                            <span>ì ìš© DSR í•œë„</span>
                            <span id="detail-dsr-limit">40%</span>
                        </div>
                        <div class="detail-row">
                            <span>ì›” ìƒí™˜í•œë„</span>
                            <span id="detail-monthly-limit">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ê¸°ì¡´ ëŒ€ì¶œ ì›”ìƒí™˜ì•¡</span>
                            <span id="detail-existing-payment">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì¥ê¸°ë Œíƒˆ/ë¦¬ìŠ¤ ì›”ë‚©ì…</span>
                            <span id="detail-rental-payment">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì‹ ê·œ ëŒ€ì¶œ ê°€ëŠ¥ ì›”ìƒí™˜ì•¡</span>
                            <span id="detail-new-payment">0ë§Œì›</span>
                        </div>
                    </div>

                    <div class="detail-card">
                        <h4>ğŸ’° ì‹¤ì œ ê°€ì²˜ë¶„ ì†Œë“ ë¶„ì„</h4>
                        <div class="detail-row">
                            <span>ì›”ì†Œë“ (ì„¸í›„)</span>
                            <span id="after-tax-monthly">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì´ ì›”ìƒí™˜ì•¡ (ëŒ€ì¶œ)</span>
                            <span id="total-loan-payment">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ìë™ì°¨ ì›”ë‚©ì…ì•¡</span>
                            <span id="auto-monthly-payment">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì´ ì›”ì§€ì¶œ (ëŒ€ì¶œ+ìë™ì°¨)</span>
                            <span id="total-monthly-expense">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ì‹¤ì œ ê°€ì²˜ë¶„ ì†Œë“</span>
                            <span id="real-disposable-income">0ë§Œì›</span>
                        </div>
                        <div class="detail-row">
                            <span>ê°€ì²˜ë¶„ì†Œë“/ì„¸í›„ì†Œë“ ë¹„ìœ¨</span>
                            <span id="disposable-ratio">0%</span>
                        </div>
                    </div>

                    <div class="detail-card">
                        <h4>ğŸ”§ ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ ì ìš© ë‚´ì—­</h4>
                        <div class="detail-row">
                            <span>ê¸°ì¤€ ê¸ˆë¦¬</span>
                            <span id="base-rate">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬</span>
                            <span id="stress-rate">0%</span>
                        </div>
                        <div class="detail-row">
                            <span>ì ìš© ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬</span>
                            <span id="applied-stress">1.5%p</span>
                        </div>
                    </div>

                    <div id="warning-section"></div>
                </div>

                <div id="no-results">
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <h3>ê³„ì‚° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</h3>
                        <p>ì¢Œì¸¡ì— ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 2025ë…„ ì‹¤ìˆ˜ë ¹ì•¡ í‘œ ë°ì´í„°
        const salaryData = [
            {salary: 1000, net: 771.033}, {salary: 1100, net: 847.286}, {salary: 1200, net: 923.500},
            {salary: 1300, net: 998.863}, {salary: 1400, net: 1073.736}, {salary: 1500, net: 1148.580},
            {salary: 1600, net: 1223.463}, {salary: 1700, net: 1297.826}, {salary: 1800, net: 1372.040},
            {salary: 1900, net: 1446.313}, {salary: 2000, net: 1520.566}, {salary: 2100, net: 1594.790},
            {salary: 2200, net: 1669.043}, {salary: 2300, net: 1743.296}, {salary: 2400, net: 1817.310},
            {salary: 2500, net: 1890.463}, {salary: 2600, net: 1963.596}, {salary: 2700, net: 2036.710},
            {salary: 2800, net: 2109.853}, {salary: 2900, net: 2179.916}, {salary: 3000, net: 2248.340},
            {salary: 3100, net: 2316.813}, {salary: 3200, net: 2384.896}, {salary: 3300, net: 2451.470},
            {salary: 3400, net: 2515.923}, {salary: 3500, net: 2580.346}, {salary: 3600, net: 2656.670},
            {salary: 3700, net: 2723.873}, {salary: 3800, net: 2788.286}, {salary: 3900, net: 2852.700},
            {salary: 4000, net: 2917.143}, {salary: 4100, net: 2981.576}, {salary: 4200, net: 3045.970},
            {salary: 4300, net: 3110.423}, {salary: 4400, net: 3174.836}, {salary: 4500, net: 3239.250},
            {salary: 4600, net: 3303.693}, {salary: 4700, net: 3362.136}, {salary: 4800, net: 3425.500},
            {salary: 4900, net: 3488.923}, {salary: 5000, net: 3552.316}, {salary: 5100, net: 3615.690},
            {salary: 5200, net: 3679.103}, {salary: 5300, net: 3742.506}, {salary: 5400, net: 3805.860},
            {salary: 5500, net: 3869.273}, {salary: 5600, net: 3932.666}, {salary: 5700, net: 3993.290},
            {salary: 5800, net: 4056.723}, {salary: 5900, net: 4120.116}, {salary: 6000, net: 4183.470},
            {salary: 6100, net: 4246.893}, {salary: 6200, net: 4310.286}, {salary: 6300, net: 4373.660},
            {salary: 6400, net: 4437.073}, {salary: 6500, net: 4500.476}, {salary: 6600, net: 4562.980},
            {salary: 6700, net: 4618.693}, {salary: 6800, net: 4674.376}, {salary: 6900, net: 4730.080},
            {salary: 7000, net: 4785.823}, {salary: 7100, net: 4841.546}, {salary: 7200, net: 4869.760},
            {salary: 7300, net: 4925.283}, {salary: 7400, net: 4980.786}, {salary: 7500, net: 5036.270},
            {salary: 7600, net: 5091.793}, {salary: 7700, net: 5147.306}, {salary: 7800, net: 5202.780},
            {salary: 7900, net: 5258.303}, {salary: 8000, net: 5313.816}, {salary: 8100, net: 5369.290},
            {salary: 8200, net: 5424.823}, {salary: 8300, net: 5480.326}, {salary: 8400, net: 5535.820},
            {salary: 8500, net: 5591.343}, {salary: 8600, net: 5646.836}, {salary: 8700, net: 5702.330},
            {salary: 8800, net: 5757.853}, {salary: 8900, net: 5813.366}, {salary: 9000, net: 5868.840},
            {salary: 9100, net: 5924.353}, {salary: 9200, net: 5979.866}, {salary: 9300, net: 6035.350},
            {salary: 9400, net: 6090.883}, {salary: 9500, net: 6146.386}, {salary: 9600, net: 6201.850},
            {salary: 9700, net: 6257.383}, {salary: 9800, net: 6312.886}, {salary: 9900, net: 6368.380},
            {salary: 10000, net: 6423.903}, {salary: 10100, net: 6479.406}, {salary: 10200, net: 6534.350},
            {salary: 10300, net: 6589.213}, {salary: 10400, net: 6644.076}, {salary: 10500, net: 6698.900},
            {salary: 10600, net: 6753.773}, {salary: 10700, net: 6808.606}, {salary: 10800, net: 6863.420},
            {salary: 10900, net: 6918.293}, {salary: 11000, net: 6968.006}, {salary: 11100, net: 7013.020},
            {salary: 11200, net: 7058.073}, {salary: 11300, net: 7103.096}, {salary: 11400, net: 7148.100},
            {salary: 11500, net: 7193.163}, {salary: 11600, net: 7238.206}, {salary: 11700, net: 7283.220},
            {salary: 11800, net: 7328.263}, {salary: 11900, net: 7373.296}, {salary: 12000, net: 7418.310},
            {salary: 12100, net: 7463.363}, {salary: 12200, net: 7389.566}, {salary: 12300, net: 7434.420},
            {salary: 12400, net: 7479.303}, {salary: 12500, net: 7524.186}, {salary: 12600, net: 7569.030},
            {salary: 12700, net: 7613.933}, {salary: 12800, net: 7658.806}, {salary: 12900, net: 7703.650},
            {salary: 13000, net: 7748.553}, {salary: 13100, net: 7793.426}, {salary: 13200, net: 7838.270},
            {salary: 13300, net: 7883.163}, {salary: 13400, net: 7928.036}, {salary: 13500, net: 7972.900},
            {salary: 13600, net: 8017.783}, {salary: 13700, net: 8062.666}, {salary: 13800, net: 8107.510},
            {salary: 13900, net: 8152.403}, {salary: 14000, net: 8197.266}, {salary: 14100, net: 8242.130},
            {salary: 14200, net: 8287.033}, {salary: 14300, net: 8331.906}, {salary: 14400, net: 8376.740},
            {salary: 14500, net: 8421.633}, {salary: 14600, net: 8466.516}, {salary: 14700, net: 8511.370},
            {salary: 14800, net: 8556.263}, {salary: 14900, net: 8601.146}, {salary: 15000, net: 8645.980}
        ];

        // ì†Œë“ ìœ í˜• ë³€ê²½ ì‹œ ë¼ë²¨ ì—…ë°ì´íŠ¸
        document.querySelectorAll('input[name="income-type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const label = document.getElementById('income-label');
                if (this.value === 'gross') {
                    label.textContent = 'ì—°ì†Œë“ (ì„¸ì „, ë§Œì›)';
                } else {
                    label.textContent = 'ì‹¤ìˆ˜ë ¹ì•¡ (ì—°ê°„, ë§Œì›)';
                }
                document.getElementById('income').placeholder = this.value === 'gross' ? 'ì˜ˆ: 5000' : 'ì˜ˆ: 3552';
            });
        });

        // ì„ í˜•ë³´ê°„ë²•ìœ¼ë¡œ ì‹¤ìˆ˜ë ¹ì•¡ ê³„ì‚°
        function calculateNetFromGross(grossIncome) {
            if (grossIncome <= 1000) return grossIncome * 0.771033;
            if (grossIncome >= 15000) {
                // 15000ë§Œì› ì´ìƒì€ ì„¸ìœ¨ êµ¬ê°„ë³„ë¡œ ë” ì •í™•í•˜ê²Œ ê³„ì‚°
                if (grossIncome <= 20000) {
                    return grossIncome * 0.576; // ì•½ 42.4% ì„¸ìœ¨
                } else if (grossIncome <= 30000) {
                    return grossIncome * 0.55; // ì•½ 45% ì„¸ìœ¨  
                } else {
                    return grossIncome * 0.52; // ì•½ 48% ì„¸ìœ¨
                }
            }

            // ì„ í˜•ë³´ê°„
            for (let i = 0; i < salaryData.length - 1; i++) {
                if (grossIncome >= salaryData[i].salary && grossIncome <= salaryData[i + 1].salary) {
                    const x1 = salaryData[i].salary;
                    const y1 = salaryData[i].net;
                    const x2 = salaryData[i + 1].salary;
                    const y2 = salaryData[i + 1].net;
                    
                    return y1 + (y2 - y1) * (grossIncome - x1) / (x2 - x1);
                }
            }
            return grossIncome * 0.57; // ê¸°ë³¸ ì¶”ì •ì¹˜
        }

        // ì—­ì‚°ìœ¼ë¡œ ì„¸ì „ì†Œë“ ê³„ì‚°
        function calculateGrossFromNet(netIncome) {
            if (netIncome <= 771.033) return netIncome / 0.771033;
            if (netIncome >= 8645.980) {
                // ê³ ì†Œë“ êµ¬ê°„ë³„ ì—­ì‚°
                if (netIncome <= 11520) { // 2ë§Œë§Œì› ì¶”ì •
                    return netIncome / 0.576;
                } else if (netIncome <= 16500) { // 3ë§Œë§Œì› ì¶”ì •
                    return netIncome / 0.55;
                } else {
                    return netIncome / 0.52;
                }
            }

            // ì„ í˜•ë³´ê°„ìœ¼ë¡œ ì—­ì‚°
            for (let i = 0; i < salaryData.length - 1; i++) {
                if (netIncome >= salaryData[i].net && netIncome <= salaryData[i + 1].net) {
                    const x1 = salaryData[i].net;
                    const y1 = salaryData[i].salary;
                    const x2 = salaryData[i + 1].net;
                    const y2 = salaryData[i + 1].salary;
                    
                    return y1 + (y2 - y1) * (netIncome - x1) / (x2 - x1);
                }
            }
            return netIncome / 0.57; // ê³ ì†Œë“ êµ¬ê°„ ê¸°ë³¸ ì¶”ì •ì¹˜
        }

        function calculateLoan() {
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const incomeType = document.querySelector('input[name="income-type"]:checked').value;
            const inputIncome = parseFloat(document.getElementById('income').value) || 0;
            const region = document.getElementById('region').value;
            const financialSector = document.getElementById('financial-sector').value;
            const existingMortgage = parseFloat(document.getElementById('existing-mortgage').value) || 0;
            const existingCredit = parseFloat(document.getElementById('existing-credit').value) || 0;
            const existingCard = parseFloat(document.getElementById('existing-card').value) || 0;
            const existingOther = parseFloat(document.getElementById('existing-other').value) || 0;
            const autoLoan = parseFloat(document.getElementById('auto-loan').value) || 0;
            const rentalMonthly = parseFloat(document.getElementById('rental-monthly').value) || 0;
            const rentalTerm = parseFloat(document.getElementById('rental-term').value) || 0;
            const interestRate = parseFloat(document.getElementById('interest-rate').value) || 4.5;
            const loanTerm = parseFloat(document.getElementById('loan-term').value) || 30;
            const isPolicyLoan = document.getElementById('policy-loan').checked;

            if (inputIncome <= 0) {
                alert('ì†Œë“ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì„¸ì „/ì„¸í›„ ì†Œë“ ê³„ì‚°
            let grossIncome, netIncome;
            if (incomeType === 'gross') {
                grossIncome = inputIncome;
                netIncome = calculateNetFromGross(grossIncome);
            } else {
                netIncome = inputIncome;
                grossIncome = calculateGrossFromNet(netIncome);
            }

            // DSR í•œë„ ì„¤ì •
            const dsrLimit = financialSector === '1st' ? 0.40 : 0.50;

            // ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ ì„¤ì •
            let stressRate;
            if (region === 'metropolitan') {
                stressRate = 1.5; // ìˆ˜ë„ê¶Œ 1.5%p
            } else {
                stressRate = 0.75; // ë¹„ìˆ˜ë„ê¶Œ 0.75%p (12ì›” 31ì¼ê¹Œì§€)
            }

            // ì›”ì†Œë“ ê³„ì‚° (ì„¸ì „ ê¸°ì¤€)
            const monthlyGrossIncome = grossIncome / 12;
            const monthlyNetIncome = netIncome / 12;

            // ì›” ìƒí™˜í•œë„ ê³„ì‚° (ì„¸ì „ ì†Œë“ ê¸°ì¤€)
            const monthlyLimit = monthlyGrossIncome * dsrLimit;

            // ê¸°ì¡´ ëŒ€ì¶œ ì›”ìƒí™˜ì•¡ ê³„ì‚° (ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ ì ìš©)
            const existingMortgagePayment = existingMortgage > 0 ? 
                calculateMonthlyPayment(existingMortgage * 10000, interestRate + stressRate, loanTerm) : 0;
            
            // ì‹ ìš©ëŒ€ì¶œì€ 1ì–µ ì´ˆê³¼ë¶„ì—ë§Œ ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ ì ìš©
            let existingCreditPayment = 0;
            if (existingCredit > 0) {
                if (existingCredit <= 1000) { // 1ì–µ ì´í•˜
                    existingCreditPayment = calculateMonthlyPayment(existingCredit * 10000, interestRate, 5);
                } else { // 1ì–µ ì´ˆê³¼
                    const under100M = 1000;
                    const over100M = existingCredit - 1000;
                    existingCreditPayment = calculateMonthlyPayment(under100M * 10000, interestRate, 5) + 
                                          calculateMonthlyPayment(over100M * 10000, interestRate + stressRate, 5);
                }
            }

            const existingCardPayment = existingCard > 0 ? 
                calculateMonthlyPayment(existingCard * 10000, interestRate + stressRate, 3) : 0;
            const existingOtherPayment = existingOther > 0 ? 
                calculateMonthlyPayment(existingOther * 10000, interestRate + stressRate, 5) : 0;

            // ìë™ì°¨ ëŒ€ì¶œ ì›”ìƒí™˜ì•¡ (ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ ì ìš©)
            const autoLoanPayment = autoLoan > 0 ? 
                calculateMonthlyPayment(autoLoan * 10000, interestRate + stressRate, 5) : 0;

            // ë Œíƒˆ/ë¦¬ìŠ¤ ì›”ë‚©ì…ì•¡ë„ DSRì— í¬í•¨ (DSR 3ë‹¨ê³„)
            const rentalPayment = rentalMonthly;

            // DSR ê³„ì‚°ì— í¬í•¨ë˜ëŠ” ì›”ìƒí™˜ì•¡ (ìë™ì°¨ ëŒ€ì¶œ + ë Œíƒˆ/ë¦¬ìŠ¤ ëª¨ë‘ í¬í•¨)
            const totalExistingPaymentForDSR = existingMortgagePayment + existingCreditPayment + 
                                             existingCardPayment + existingOtherPayment + 
                                             autoLoanPayment + rentalPayment;

            // ì‹ ê·œ ëŒ€ì¶œ ê°€ëŠ¥ ì›”ìƒí™˜ì•¡
            const newPaymentCapacity = Math.max(0, monthlyLimit - totalExistingPaymentForDSR);

            // ì‹ ê·œ ëŒ€ì¶œ ê°€ëŠ¥ ê¸ˆì•¡ ê³„ì‚°
            const appliedRate = isPolicyLoan ? interestRate : interestRate + stressRate;
            const maxLoanAmount = newPaymentCapacity > 0 ? 
                calculateLoanAmount(newPaymentCapacity, appliedRate, loanTerm) : 0;

            // ì‹¤ì œ ì›”ìƒí™˜ì•¡ ê³„ì‚° (ì‹¤ì œ ê¸ˆë¦¬ ê¸°ì¤€)
            const actualMortgagePayment = existingMortgage > 0 ? 
                calculateMonthlyPayment(existingMortgage * 10000, interestRate, loanTerm) : 0;
            const actualCreditPayment = existingCredit > 0 ? 
                calculateMonthlyPayment(existingCredit * 10000, interestRate, 5) : 0;
            const actualCardPayment = existingCard > 0 ? 
                calculateMonthlyPayment(existingCard * 10000, interestRate, 3) : 0;
            const actualOtherPayment = existingOther > 0 ? 
                calculateMonthlyPayment(existingOther * 10000, interestRate, 5) : 0;
            const actualAutoLoanPayment = autoLoan > 0 ? 
                calculateMonthlyPayment(autoLoan * 10000, interestRate, 5) : 0;
            const actualNewPayment = maxLoanAmount > 0 ? 
                calculateMonthlyPayment(maxLoanAmount, interestRate, loanTerm) : 0;

            // ì´ ëŒ€ì¶œ ì›”ìƒí™˜ì•¡
            const totalLoanPayment = actualMortgagePayment + actualCreditPayment + actualCardPayment + 
                                   actualOtherPayment + actualAutoLoanPayment + actualNewPayment;

            // ì´ ìë™ì°¨ ê´€ë ¨ ì›”ë‚©ì…ì•¡
            const totalAutoPayment = actualAutoLoanPayment + rentalPayment;

            // ì´ ì›”ì§€ì¶œ (ëŒ€ì¶œ + ìë™ì°¨) - ë Œíƒˆì€ ì´ë¯¸ ëŒ€ì¶œì— í¬í•¨ë˜ì–´ ìˆìŒ
            const totalMonthlyExpense = totalLoanPayment + rentalPayment;

            // ì‹¤ì œ ê°€ì²˜ë¶„ ì†Œë“ (ì„¸í›„ ì†Œë“ - ì´ ì›”ì§€ì¶œ)
            const realDisposableIncome = monthlyNetIncome - totalMonthlyExpense;
            const disposableRatio = monthlyNetIncome > 0 ? (realDisposableIncome / monthlyNetIncome * 100) : 0;

            // ê²°ê³¼ í‘œì‹œ
            displayResults({
                inputIncome: inputIncome,
                incomeType: incomeType,
                grossIncome: grossIncome,
                netIncome: netIncome,
                monthlyGrossIncome: monthlyGrossIncome,
                monthlyNetIncome: monthlyNetIncome,
                maxLoan: maxLoanAmount,
                dsrLimit: dsrLimit,
                monthlyLimit: monthlyLimit,
                totalExistingPaymentForDSR: totalExistingPaymentForDSR,
                autoLoanPayment: autoLoanPayment,
                rentalPayment: rentalPayment,
                totalAutoPayment: totalAutoPayment,
                newPaymentCapacity: newPaymentCapacity,
                totalLoanPayment: totalLoanPayment,
                totalMonthlyExpense: totalMonthlyExpense,
                realDisposableIncome: realDisposableIncome,
                disposableRatio: disposableRatio,
                baseRate: interestRate,
                stressRate: stressRate,
                appliedRate: appliedRate,
                region: region,
                financialSector: financialSector,
                isPolicyLoan: isPolicyLoan
            });
        }

        function calculateMonthlyPayment(principal, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = years * 12;
            
            if (monthlyRate === 0) {
                return principal / numPayments;
            }
            
            const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                 (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            return monthlyPayment / 10000; // ë§Œì› ë‹¨ìœ„ë¡œ ë³€í™˜
        }

        function calculateLoanAmount(monthlyPayment, annualRate, years) {
            const monthlyRate = annualRate / 100 / 12;
            const numPayments = years * 12;
            
            if (monthlyRate === 0) {
                return monthlyPayment * numPayments * 10000;
            }
            
            const loanAmount = (monthlyPayment * 10000) * (Math.pow(1 + monthlyRate, numPayments) - 1) / 
                             (monthlyRate * Math.pow(1 + monthlyRate, numPayments));
            
            return loanAmount;
        }

        function displayResults(data) {
            document.getElementById('results').style.display = 'block';
            document.getElementById('no-results').style.display = 'none';

            // ëŒ€ì¶œí•œë„ í‘œì‹œ
            document.getElementById('max-loan').textContent = formatNumber(Math.round(data.maxLoan)) + 'ì›';

            // ì†Œë“ ì •ë³´ í‘œì‹œ
            document.getElementById('input-income').textContent = 
                formatNumber(data.inputIncome) + 'ë§Œì› (' + (data.incomeType === 'gross' ? 'ì„¸ì „' : 'ì‹¤ìˆ˜ë ¹') + ')';
            document.getElementById('gross-income').textContent = formatNumber(Math.round(data.grossIncome)) + 'ë§Œì›';
            document.getElementById('net-income').textContent = formatNumber(Math.round(data.netIncome)) + 'ë§Œì›';
            document.getElementById('monthly-gross').textContent = formatNumber(Math.round(data.monthlyGrossIncome)) + 'ë§Œì›';
            document.getElementById('monthly-net').textContent = formatNumber(Math.round(data.monthlyNetIncome)) + 'ë§Œì›';

            // DSR ìƒì„¸ ë‚´ì—­ í‘œì‹œ
            document.getElementById('detail-dsr-limit').textContent = (data.dsrLimit * 100) + '%';
            document.getElementById('detail-monthly-limit').textContent = formatNumber(Math.round(data.monthlyLimit)) + 'ë§Œì›';
            document.getElementById('detail-existing-payment').textContent = formatNumber(Math.round(data.totalExistingPaymentForDSR - data.autoLoanPayment - data.rentalPayment)) + 'ë§Œì›';
            document.getElementById('detail-auto-payment').textContent = formatNumber(Math.round(data.autoLoanPayment)) + 'ë§Œì›';
            document.getElementById('detail-rental-payment').textContent = formatNumber(Math.round(data.rentalPayment)) + 'ë§Œì›';
            document.getElementById('detail-new-payment').textContent = formatNumber(Math.round(data.newPaymentCapacity)) + 'ë§Œì›';

            // ì‹¤ì œ ê°€ì²˜ë¶„ ì†Œë“ ì •ë³´
            document.getElementById('after-tax-monthly').textContent = formatNumber(Math.round(data.monthlyNetIncome)) + 'ë§Œì›';
            document.getElementById('total-loan-payment').textContent = formatNumber(Math.round(data.totalLoanPayment)) + 'ë§Œì›';
            document.getElementById('auto-monthly-payment').textContent = formatNumber(Math.round(data.totalAutoPayment)) + 'ë§Œì›';
            document.getElementById('total-monthly-expense').textContent = formatNumber(Math.round(data.totalMonthlyExpense)) + 'ë§Œì›';
            document.getElementById('real-disposable-income').textContent = formatNumber(Math.round(data.realDisposableIncome)) + 'ë§Œì›';
            document.getElementById('disposable-ratio').textContent = Math.round(data.disposableRatio) + '%';

            // ê¸ˆë¦¬ ì •ë³´
            document.getElementById('base-rate').textContent = data.baseRate + '%';
            document.getElementById('stress-rate').textContent = (data.baseRate + data.stressRate) + '%';
            
            // ê²½ê³  ë©”ì‹œì§€
            const warningSection = document.getElementById('warning-section');
            warningSection.innerHTML = '';

            if (data.realDisposableIncome < 0) {
                warningSection.innerHTML += `
                    <div class="warning">
                        <strong>âš ï¸ ìœ„í—˜:</strong> ì‹¤ì œ ê°€ì²˜ë¶„ ì†Œë“ì´ ìŒìˆ˜ì…ë‹ˆë‹¤! í˜„ì¬ ê³„íšìœ¼ë¡œëŠ” ìƒí™œì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            }

            if (data.disposableRatio < 20) {
                warningSection.innerHTML += `
                    <div class="warning">
                        <strong>âš ï¸ ì£¼ì˜:</strong> ê°€ì²˜ë¶„ ì†Œë“ ë¹„ìœ¨ì´ ${Math.round(data.disposableRatio)}%ë¡œ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. 
                        ìµœì†Œ 30% ì´ìƒ ìœ ì§€ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
                    </div>
                `;
            } else if (data.disposableRatio < 30) {
                warningSection.innerHTML += `
                    <div class="warning">
                        <strong>âš ï¸ ì£¼ì˜:</strong> ê°€ì²˜ë¶„ ì†Œë“ ë¹„ìœ¨ì´ ${Math.round(data.disposableRatio)}%ì…ë‹ˆë‹¤. 
                        ì—¬ìœ ìê¸ˆ í™•ë³´ë¥¼ ìœ„í•´ 30% ì´ìƒ ìœ ì§€ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
                    </div>
                `;
            } else if (data.disposableRatio >= 50) {
                warningSection.innerHTML += `
                    <div class="success-box">
                        <strong>âœ… ì–‘í˜¸:</strong> ê°€ì²˜ë¶„ ì†Œë“ ë¹„ìœ¨ì´ ${Math.round(data.disposableRatio)}%ë¡œ ê±´ì „í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.
                    </div>
                `;
            }

            if (data.region === 'non-metropolitan') {
                warningSection.innerHTML += `
                    <div class="info-box">
                        <strong>ğŸ“… ì•ˆë‚´:</strong> ë¹„ìˆ˜ë„ê¶Œ ì£¼íƒì€ 2025ë…„ 12ì›” 31ì¼ê¹Œì§€ ìŠ¤íŠ¸ë ˆìŠ¤ ê¸ˆë¦¬ 0.75%pê°€ ì ìš©ë©ë‹ˆë‹¤. 
                        2026ë…„ 1ì›” 1ì¼ë¶€í„°ëŠ” 1.5%pë¡œ ìƒí–¥ ì¡°ì •ë©ë‹ˆë‹¤.
                    </div>
                `;
            }

            if (data.isPolicyLoan) {
                warningSection.innerHTML += `
                    <div class="info-box">
                        <strong>ğŸ›ï¸ ì•ˆë‚´:</strong> ì •ì±…ëª¨ê¸°ì§€ëŠ” ìŠ¤íŠ¸ë ˆìŠ¤ DSR ê³„ì‚°ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤. 
                        ë³´ê¸ˆìë¦¬ë¡ , ë””ë”¤ëŒëŒ€ì¶œ ë“±ì„ ì ê·¹ í™œìš©í•´ë³´ì„¸ìš”.
                    </div>
                `;
            }

            if (data.totalAutoPayment > 0) {
                warningSection.innerHTML += `
                    <div class="info-box">
                        <strong>ğŸš— DSR 3ë‹¨ê³„ ìë™ì°¨ ê´€ë ¨:</strong><br>
                        â€¢ ìë™ì°¨ ëŒ€ì¶œ: DSRì— í¬í•¨ë˜ì–´ ì£¼íƒëŒ€ì¶œ í•œë„ì— ì˜í–¥<br>
                        â€¢ ì¥ê¸°ë Œíƒˆ/ë¦¬ìŠ¤: DSR 3ë‹¨ê³„ë¶€í„° í¬í•¨ (ê¸°ì¡´ 2ë‹¨ê³„ê¹Œì§€ëŠ” ë¯¸í¬í•¨)<br>
                        â€¢ ì´ ìë™ì°¨ ê´€ë ¨ ì›”ë‚©ì…: ${formatNumber(Math.round(data.totalAutoPayment))}ë§Œì›<br>
                        â€¢ ëª¨ë“  ìë™ì°¨ ê´€ë ¨ ì§€ì¶œì´ DSR í•œë„ì— ë°˜ì˜ë¨
                    </div>
                `;
            }

            // ì‹¤ìš©ì  ì¡°ì–¸ ì¶”ê°€
            if (data.newPaymentCapacity < 100) {
                warningSection.innerHTML += `
                    <div class="warning">
                        <strong>ğŸ’¡ DSR í•œë„ ê°œì„  ë°©ì•ˆ:</strong><br>
                        â€¢ ê¸°ì¡´ ëŒ€ì¶œ ì¼ë¶€ ìƒí™˜ìœ¼ë¡œ DSR ì—¬ìœ  í™•ë³´<br>
                        â€¢ ìë™ì°¨ ëŒ€ì¶œì„ ì¥ê¸°ë Œíƒˆë¡œ ì „í™˜í•´ë„ DSR 3ë‹¨ê³„ë¶€í„°ëŠ” ë™ì¼í•˜ê²Œ ë°˜ì˜<br>
                        â€¢ ì •ì±…ëª¨ê¸°ì§€(ë³´ê¸ˆìë¦¬ë¡  ë“±) ì ê·¹ í™œìš©<br>
                        â€¢ 2ê¸ˆìœµê¶Œë³´ë‹¤ 1ê¸ˆìœµê¶Œ ì´ìš© ì‹œ DSR í•œë„ 10%p ë†’ìŒ
                    </div>
                `;
            }
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // ì´ˆê¸° ë¡œë“œ ì‹œ ê¸°ë³¸ê°’ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('interest-rate').value = '4.5';
            document.getElementById('loan-term').value = '30';
        });
    </script>
</body>
</html>
